# Story 1.2: Raspberry Pi OS Setup and SSH Access

## Status
Ready for Review

## Story
**As a** developer,
**I want** Raspberry Pi Zero 2 W flashed with Raspberry Pi OS and accessible via SSH,
**so that** I can remotely develop and debug firmware without needing a monitor/keyboard connected to the Pi.

## Acceptance Criteria
1. Raspberry Pi OS Lite (64-bit) flashed to 16-32GB MicroSD card using Raspberry Pi Imager
2. SSH enabled (headless setup via Raspberry Pi Imager or manual config)
3. WiFi configured for local network connectivity
4. Successfully SSH into Pi from development PC (ssh pi@raspberrypi.local)
5. Static IP assigned or hostname resolves reliably for consistent access
6. Python 3.9+ verified (pre-installed on Raspberry Pi OS)

## Tasks / Subtasks

**‚ö†Ô∏è HARDWARE SETUP - HUMAN REQUIRED:**

- [x] **[HUMAN]** Flash Raspberry Pi OS to MicroSD card (AC: 1, 2, 3)
  - [x] **[HUMAN]** Download and install Raspberry Pi Imager on development PC
  - [x] **[HUMAN]** Insert 16-32GB MicroSD card into PC card reader
  - [x] **[HUMAN]** Open Raspberry Pi Imager, select "Raspberry Pi OS Lite (64-bit)" from OS list
  - [x] **[HUMAN]** Select MicroSD card as storage device
  - [x] **[HUMAN]** Click gear icon to configure advanced options:
    - [x] Enable SSH with password authentication
    - [x] Set username and password (e.g., username: pi, password: [secure password])
    - [x] Configure WiFi SSID and password for local network
    - [x] Set locale settings (timezone, keyboard layout)
  - [x] **[HUMAN]** Click "Write" to flash OS to MicroSD card
  - [x] **[HUMAN]** Wait for write and verification to complete
  - [x] **[HUMAN]** Safely eject MicroSD card

- [x] **[HUMAN]** Boot Raspberry Pi and verify SSH access (AC: 4)
  - [x] **[HUMAN]** Insert MicroSD card into Raspberry Pi Zero 2 W
  - [x] **[HUMAN]** Connect power supply to Raspberry Pi (micro USB, 5V 2.5A recommended)
  - [x] **[HUMAN]** Wait 60-90 seconds for initial boot and WiFi connection
  - [x] **[HUMAN]** From development PC, attempt SSH connection: `ssh pi@opengardenlab.local`
  - [x] **[HUMAN]** Accept SSH fingerprint when prompted
  - [x] **[HUMAN]** Enter password to authenticate
  - [x] **[HUMAN]** Verify successful SSH login (command prompt shows `pi@opengardenlab:~ $`)

**ü§ñ AI AGENT CAN EXECUTE (via SSH):**

- [x] Create boot configuration templates for repository
  - [x] Create directory: `setup/raspberry-pi/boot-templates/`
  - [x] Create `setup/raspberry-pi/boot-templates/README.md` with customization instructions
  - [x] Create `setup/raspberry-pi/boot-templates/ssh` (empty file to enable SSH)
  - [x] Create `setup/raspberry-pi/boot-templates/userconf.txt` template with password hash instructions
  - [x] Create `setup/raspberry-pi/boot-templates/wpa_supplicant.conf` template with WiFi placeholder
  - [x] Document how to copy templates to SD card boot partition after flashing

- [x] Configure static IP or verify hostname resolution (AC: 5)
  - [x] Test hostname resolution: `ping opengardenlab.local` from development PC
  - [x] If hostname resolves reliably, document hostname for future access
  - [ ] If hostname fails, configure static IP:
    - [ ] Edit dhcpcd config: `sudo nano /etc/dhcpcd.conf`
    - [ ] Add static IP configuration for wlan0 interface
    - [ ] Restart dhcpcd service: `sudo systemctl restart dhcpcd`
    - [ ] Verify static IP assigned: `ip addr show wlan0`
    - [ ] Test SSH connection using static IP: `ssh pi@[static-ip]`
  - [x] Document connection method (hostname or IP) for future reference

- [x] Verify Python 3.9+ installation (AC: 6)
  - [x] Check Python version: `python3 --version`
  - [x] Verify output shows Python 3.9 or higher (pre-installed on Raspberry Pi OS)
  - [x] Verify pip3 installed: `pip3 --version`
  - [x] If pip3 missing, install: `sudo apt update && sudo apt install python3-pip`

- [x] Update system and install essential tools
  - [x] Update package lists: `sudo apt update`
  - [x] Upgrade installed packages: `sudo apt upgrade -y`
  - [x] Install git: `sudo apt install git -y`
  - [x] Verify git installed: `git --version`

## Dev Notes

### Hardware Requirements
**Raspberry Pi Zero 2 W Specifications** [Source: architecture/hardware-architecture.md]
- **CPU:** Broadcom BCM2710A1, quad-core 64-bit ARM Cortex-A53 @ 1GHz
- **RAM:** 512MB
- **WiFi:** 2.4GHz 802.11 b/g/n wireless LAN
- **Bluetooth:** Bluetooth 4.2, BLE
- **GPIO:** 40-pin header (same pinout as Raspberry Pi 3/4)
- **Power:** 5V via micro USB, ~2.5A recommended for stable operation with sensors
- **Storage:** MicroSD card (16-32GB recommended for OS + sensor data)

**Why Raspberry Pi Zero 2 W:** [Source: architecture/hardware-architecture.md]
- Quad-core CPU provides sufficient performance for sensor sampling and BLE server
- Built-in WiFi eliminates need for SSH over USB or Ethernet adapter
- Low power consumption suitable for battery operation
- Compact form factor ideal for garden deployment
- 40-pin GPIO header supports all required sensors (I2C, 1-Wire)

### Operating System Selection
**Raspberry Pi OS Lite (64-bit)** [Source: architecture/tech-stack.md, hardware-architecture.md]
- **Why Lite:** Minimal OS without desktop environment - reduces SD card space, boot time, and resource usage
- **Why 64-bit:** Required for full performance of BCM2710A1's 64-bit CPU architecture
- **Pre-installed software:** Python 3.9+, systemd, SSH server
- **Debian-based:** Extensive package repository via apt, well-documented

### SSH Configuration
**Headless Setup** [Source: epic requirements]
- Enable SSH during OS imaging to avoid needing monitor/keyboard
- Raspberry Pi Imager supports advanced options for headless setup:
  - SSH enable/disable toggle
  - Username/password configuration
  - WiFi SSID and password
  - Locale settings (timezone, keyboard)

**SSH Access Methods:**
1. **Hostname (recommended for development):** `ssh pi@opengardenlab.local`
   - Relies on mDNS (Avahi/Bonjour) for local network hostname resolution
   - Works on most networks, may fail on networks with mDNS disabled
2. **Static IP (recommended for production):** `ssh pi@172.20.1.28`
   - Configured via `/etc/dhcpcd.conf`
   - Reliable, no dependency on mDNS
   - Requires router not using the static IP for DHCP assignments

### WiFi Configuration
**Local Network Connectivity** [Source: AC 3]
- WiFi configured during Raspberry Pi Imager advanced setup
- Alternatively, manual config via `wpa_supplicant.conf` in boot partition
- Network must support 2.4GHz (Pi Zero 2 W does not support 5GHz)

**Configuration file format** (if manual setup needed):
```
country=US
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid="YourNetworkName"
    psk="YourNetworkPassword"
}
```

### Python Version Requirements
**Python 3.9+** [Source: architecture/tech-stack.md]
- Required for firmware development
- Pre-installed on Raspberry Pi OS (typically 3.9 or 3.11 depending on OS release)
- Type hints, asyncio features needed for BLE server (bleak library)
- pip3 used for installing sensor libraries (Adafruit CircuitPython)

**Verification:** `python3 --version` must show 3.9.0 or higher

### Project Structure Preparation
This story prepares the Raspberry Pi hardware environment. Future stories will:
- Story 1.3: Enable I2C and 1-Wire interfaces for sensor communication
- Story 1.4: Install Python sensor libraries
- Story 1.6+: Clone `opengardenlab` repository to `/home/pi/opengardenlab/`

### Testing
**Testing Standards for Story 1.2:**
- **Test Type:** Manual hardware verification (no automated tests)
- **Verification Steps:**
  1. ‚úÖ Raspberry Pi OS boots successfully (power LED solid, activity LED blinks during boot)
  2. ‚úÖ SSH connection succeeds from development PC
  3. ‚úÖ WiFi connected (verify with `iwconfig wlan0` or `ip addr show wlan0`)
  4. ‚úÖ Hostname or static IP resolves reliably (test with `ping` and `ssh`)
  5. ‚úÖ Python 3.9+ available (`python3 --version`)
  6. ‚úÖ pip3 installed (`pip3 --version`)
  7. ‚úÖ Git installed (`git --version`)
  8. ‚úÖ System updated (`sudo apt update && sudo apt upgrade` completes successfully)
- **Success Criteria:** Developer can SSH into Pi without physical access, Python environment ready for firmware development
- **No automated tests required** - hardware configuration story
[Source: architecture/testing-strategy.md - adapted for infrastructure story]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-03 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-10-10 | 1.1 | Story implementation completed - all tasks verified | James (Dev Agent) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
None required - hardware configuration story

### Completion Notes
**Tasks Completed:**
1. ‚úÖ Boot configuration templates verified in `setup/raspberry-pi/boot-templates/`
   - README.md with comprehensive setup instructions
   - ssh (empty file for enabling SSH)
   - userconf.txt template with password hash generation instructions
   - wpa_supplicant.conf template with WiFi configuration placeholders
2. ‚úÖ Hostname resolution verified: `opengardenlab.local` ‚Üí `172.20.1.149` (reliable, no static IP needed)

3. ‚úÖ **Python 3.9+ verification** - Python 3.13.5 installed (exceeds requirement)
   - Verified with `python3 --version` on Pi
   - pip3 25.1.1 installed via `sudo apt install python3-pip -y`

4. ‚úÖ **System update and essential tools**
   - Package lists updated: `sudo apt update`
   - System already up to date (no upgrades needed)
   - Git 2.47.3 installed and verified

**Environment Ready:**
- SSH access working via `ssh pi@opengardenlab.local` (key-based authentication configured)
- Python 3.13.5 + pip3 25.1.1 ready for firmware development
- Git installed for repository cloning
- System fully updated

### File List
**Modified Files:** None
**New Files Created:** None (templates already existed from prior work)
**Verified Files:**
- setup/raspberry-pi/boot-templates/README.md
- setup/raspberry-pi/boot-templates/ssh
- setup/raspberry-pi/boot-templates/userconf.txt
- setup/raspberry-pi/boot-templates/wpa_supplicant.conf

## QA Results

### Review Date: 2025-10-10

### Reviewed By: Quinn (Test Architect)

### Review Type: Comprehensive Infrastructure Validation

This is an infrastructure/hardware setup story with no code implementation. Review focused on requirements traceability, process verification, documentation quality, and NFR assessment.

### Code Quality Assessment

**N/A** - Infrastructure story with no code written. All work consisted of:
- Hardware setup (human-executed: OS flashing, SSH configuration, WiFi setup)
- System configuration (agent-executed: Python verification, package installation)
- Documentation verification (boot templates validated)

### Refactoring Performed

**None required** - No code to refactor. This is a hardware setup story.

### Requirements Traceability Analysis

Comprehensive Given-When-Then mapping performed for all acceptance criteria:

**AC1: Raspberry Pi OS Lite (64-bit) flashed** ‚úÖ
- Validation: Human completed via Raspberry Pi Imager, all subtasks marked complete

**AC2: SSH enabled** ‚úÖ
- Validation: Verified via successful SSH connection to `opengardenlab.local`

**AC3: WiFi configured** ‚úÖ
- Validation: Network connectivity verified (ping successful, IP: 172.20.1.149)

**AC4: Successfully SSH into Pi** ‚úÖ
- Validation: SSH connection verified by both human and agent, key-based auth configured

**AC5: Hostname resolves reliably** ‚úÖ
- Validation: `opengardenlab.local` resolves consistently to 172.20.1.149, no static IP needed

**AC6: Python 3.9+ verified** ‚úÖ
- Validation: Python 3.13.5 installed (exceeds requirement), pip3 25.1.1 installed, git 2.47.3 installed

**Coverage:** 6/6 acceptance criteria validated (100% coverage)

### Compliance Check

- **Coding Standards:** ‚úÖ N/A (no code written)
- **Project Structure:** ‚úÖ Boot templates in appropriate location (`setup/raspberry-pi/boot-templates/`)
- **Testing Strategy:** ‚úÖ Follows manual verification approach as specified (appropriate for hardware setup)
- **Tech Stack:** ‚úÖ Python 3.13.5 exceeds requirement (3.9+)
- **All ACs Met:** ‚úÖ All 6 acceptance criteria fully implemented and verified

### Test Architecture Assessment

**Test Coverage:** 100% of required manual verifications completed (8/8 verification steps)

**Test Appropriateness:** ‚úÖ Manual hardware verification is the correct approach for infrastructure setup. Automated tests would be inappropriate and impractical for this story type.

**Verification Steps Completed:**
1. ‚úÖ Pi boots successfully
2. ‚úÖ SSH connection succeeds
3. ‚úÖ WiFi connected
4. ‚úÖ Hostname resolves reliably
5. ‚úÖ Python 3.13.5 available
6. ‚úÖ pip3 25.1.1 installed
7. ‚úÖ Git 2.47.3 installed
8. ‚úÖ System updated

### Non-Functional Requirements (NFRs)

**Security: PASS** ‚úÖ
- SSH key-based authentication configured (superior to password-only)
- Boot templates include proper warnings against committing credentials
- No hardcoded secrets in repository
- Appropriate security posture for development environment

**Performance: PASS** ‚úÖ
- Python 3.13.5 significantly exceeds minimum requirement (3.9+)
- System fully updated with latest packages
- Raspberry Pi OS Lite provides minimal resource footprint

**Reliability: PASS** ‚úÖ
- Hostname resolution tested and stable
- Network connectivity verified
- Essential development tools installed
- Fallback documentation provided (static IP configuration if hostname fails)

**Maintainability: PASS** ‚úÖ
- Comprehensive boot templates documentation (6KB README)
- Clear step-by-step setup instructions
- Template files enable reproducible deployments
- Dev Agent Record properly completed with detailed notes

### Testability Evaluation

- **Controllability:** ‚úÖ Full control via SSH commands and network configuration
- **Observability:** ‚úÖ Complete visibility via SSH output and command responses
- **Debuggability:** ‚úÖ SSH access provides full debugging capability

### Technical Debt Identification

**None identified.** This is a clean infrastructure setup with:
- No code shortcuts or workarounds
- Comprehensive documentation for future developers
- Proper template files for reproducible setup
- No missing tests (manual verification is appropriate and complete)

### Security Review

‚úÖ **No security concerns identified**

**Positive security practices:**
- SSH key-based authentication established (dev PC ‚Üí Pi)
- Boot templates warn users not to commit credentials
- No secrets in version control
- Secure password hashing instructions documented (OpenSSL SHA-512)

**Not applicable for MVP:**
- Production hardening (firewall rules, fail2ban) - appropriate for future deployment story

### Performance Considerations

‚úÖ **No performance issues identified**

**Positive performance characteristics:**
- Raspberry Pi OS Lite (minimal footprint, no GUI overhead)
- Python 3.13.5 (latest stable release with performance improvements)
- System fully updated (latest security patches and bug fixes)
- 512MB RAM sufficient for MVP sensor sampling workload

### Documentation Quality Assessment

‚úÖ **Excellent documentation quality**

**Boot Templates README:**
- Comprehensive 227-line guide
- Clear "When to Use" decision tree (GUI vs manual)
- Step-by-step instructions with examples
- Troubleshooting section for common issues
- Security warnings prominently displayed

**Story Documentation:**
- Dev Notes section well-researched with architecture references
- Testing section clearly defines verification approach
- Dev Agent Record complete with all required details

### Files Modified During Review

**None** - QA review did not require code changes. This is purely an assessment.

### Improvements Checklist

**All items completed by development team:**
- [x] All 6 acceptance criteria validated
- [x] Boot templates comprehensive and production-ready
- [x] SSH key authentication configured
- [x] Python environment verified (3.13.5 + pip3 + git)
- [x] System fully updated
- [x] Documentation complete and high quality

**Future recommendations (non-blocking):**
- [ ] Consider adding WiFi troubleshooting note for 5GHz networks in README (Pi Zero 2 W only supports 2.4GHz)
- [ ] Future story: Add automated health check script to verify Pi configuration after updates

### Gate Status

**Gate: PASS** ‚úÖ

**Quality Score:** 100/100

Gate file: [docs/qa/gates/1.2-raspberry-pi-os-setup.yml](../qa/gates/1.2-raspberry-pi-os-setup.yml)

**Decision Summary:**
- All acceptance criteria validated (100% coverage)
- All NFRs pass (security, performance, reliability, maintainability)
- No blocking issues identified
- Documentation exceeds quality standards
- Infrastructure ready for firmware development (Story 1.3+)

### Recommended Status

‚úÖ **Ready for Done**

**Rationale:**
- All tasks completed and verified
- All acceptance criteria met with evidence
- No code quality issues (infrastructure story)
- No security concerns
- Comprehensive documentation in place
- Environment validated and operational

**Next Steps:**
Story owner may mark this story as **Done** and proceed to Story 1.3 (Enable I2C and 1-Wire interfaces for sensor communication).
