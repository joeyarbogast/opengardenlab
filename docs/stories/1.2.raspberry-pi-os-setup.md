# Story 1.2: Raspberry Pi OS Setup and SSH Access

## Status
Ready

## Story
**As a** developer,
**I want** Raspberry Pi Zero 2 W flashed with Raspberry Pi OS and accessible via SSH,
**so that** I can remotely develop and debug firmware without needing a monitor/keyboard connected to the Pi.

## Acceptance Criteria
1. Raspberry Pi OS Lite (64-bit) flashed to 16-32GB MicroSD card using Raspberry Pi Imager
2. SSH enabled (headless setup via Raspberry Pi Imager or manual config)
3. WiFi configured for local network connectivity
4. Successfully SSH into Pi from development PC (ssh pi@raspberrypi.local)
5. Static IP assigned or hostname resolves reliably for consistent access
6. Python 3.9+ verified (pre-installed on Raspberry Pi OS)

## Tasks / Subtasks

**‚ö†Ô∏è HARDWARE SETUP - HUMAN REQUIRED:**

- [x] **[HUMAN]** Flash Raspberry Pi OS to MicroSD card (AC: 1, 2, 3)
  - [x] **[HUMAN]** Download and install Raspberry Pi Imager on development PC
  - [x] **[HUMAN]** Insert 16-32GB MicroSD card into PC card reader
  - [x] **[HUMAN]** Open Raspberry Pi Imager, select "Raspberry Pi OS Lite (64-bit)" from OS list
  - [x] **[HUMAN]** Select MicroSD card as storage device
  - [x] **[HUMAN]** Click gear icon to configure advanced options:
    - [x] Enable SSH with password authentication
    - [x] Set username and password (e.g., username: pi, password: [secure password])
    - [x] Configure WiFi SSID and password for local network
    - [x] Set locale settings (timezone, keyboard layout)
  - [x] **[HUMAN]** Click "Write" to flash OS to MicroSD card
  - [x] **[HUMAN]** Wait for write and verification to complete
  - [x] **[HUMAN]** Safely eject MicroSD card

- [x] **[HUMAN]** Boot Raspberry Pi and verify SSH access (AC: 4)
  - [x] **[HUMAN]** Insert MicroSD card into Raspberry Pi Zero 2 W
  - [x] **[HUMAN]** Connect power supply to Raspberry Pi (micro USB, 5V 2.5A recommended)
  - [x] **[HUMAN]** Wait 60-90 seconds for initial boot and WiFi connection
  - [x] **[HUMAN]** From development PC, attempt SSH connection: `ssh pi@opengardenlab.local`
  - [x] **[HUMAN]** Accept SSH fingerprint when prompted
  - [x] **[HUMAN]** Enter password to authenticate
  - [x] **[HUMAN]** Verify successful SSH login (command prompt shows `pi@opengardenlab:~ $`)

**ü§ñ AI AGENT CAN EXECUTE (via SSH):**

- [ ] Create boot configuration templates for repository
  - [ ] Create directory: `setup/raspberry-pi/boot-templates/`
  - [ ] Create `setup/raspberry-pi/boot-templates/README.md` with customization instructions
  - [ ] Create `setup/raspberry-pi/boot-templates/ssh` (empty file to enable SSH)
  - [ ] Create `setup/raspberry-pi/boot-templates/userconf.txt` template with password hash instructions
  - [ ] Create `setup/raspberry-pi/boot-templates/wpa_supplicant.conf` template with WiFi placeholder
  - [ ] Document how to copy templates to SD card boot partition after flashing

- [ ] Configure static IP or verify hostname resolution (AC: 5)
  - [ ] Test hostname resolution: `ping opengardenlab.local` from development PC
  - [ ] If hostname resolves reliably, document hostname for future access
  - [ ] If hostname fails, configure static IP:
    - [ ] Edit dhcpcd config: `sudo nano /etc/dhcpcd.conf`
    - [ ] Add static IP configuration for wlan0 interface
    - [ ] Restart dhcpcd service: `sudo systemctl restart dhcpcd`
    - [ ] Verify static IP assigned: `ip addr show wlan0`
    - [ ] Test SSH connection using static IP: `ssh pi@[static-ip]`
  - [ ] Document connection method (hostname or IP) for future reference

- [ ] Verify Python 3.9+ installation (AC: 6)
  - [ ] Check Python version: `python3 --version`
  - [ ] Verify output shows Python 3.9 or higher (pre-installed on Raspberry Pi OS)
  - [ ] Verify pip3 installed: `pip3 --version`
  - [ ] If pip3 missing, install: `sudo apt update && sudo apt install python3-pip`

- [ ] Update system and install essential tools
  - [ ] Update package lists: `sudo apt update`
  - [ ] Upgrade installed packages: `sudo apt upgrade -y`
  - [ ] Install git: `sudo apt install git -y`
  - [ ] Verify git installed: `git --version`

## Dev Notes

### Hardware Requirements
**Raspberry Pi Zero 2 W Specifications** [Source: architecture/hardware-architecture.md]
- **CPU:** Broadcom BCM2710A1, quad-core 64-bit ARM Cortex-A53 @ 1GHz
- **RAM:** 512MB
- **WiFi:** 2.4GHz 802.11 b/g/n wireless LAN
- **Bluetooth:** Bluetooth 4.2, BLE
- **GPIO:** 40-pin header (same pinout as Raspberry Pi 3/4)
- **Power:** 5V via micro USB, ~2.5A recommended for stable operation with sensors
- **Storage:** MicroSD card (16-32GB recommended for OS + sensor data)

**Why Raspberry Pi Zero 2 W:** [Source: architecture/hardware-architecture.md]
- Quad-core CPU provides sufficient performance for sensor sampling and BLE server
- Built-in WiFi eliminates need for SSH over USB or Ethernet adapter
- Low power consumption suitable for battery operation
- Compact form factor ideal for garden deployment
- 40-pin GPIO header supports all required sensors (I2C, 1-Wire)

### Operating System Selection
**Raspberry Pi OS Lite (64-bit)** [Source: architecture/tech-stack.md, hardware-architecture.md]
- **Why Lite:** Minimal OS without desktop environment - reduces SD card space, boot time, and resource usage
- **Why 64-bit:** Required for full performance of BCM2710A1's 64-bit CPU architecture
- **Pre-installed software:** Python 3.9+, systemd, SSH server
- **Debian-based:** Extensive package repository via apt, well-documented

### SSH Configuration
**Headless Setup** [Source: epic requirements]
- Enable SSH during OS imaging to avoid needing monitor/keyboard
- Raspberry Pi Imager supports advanced options for headless setup:
  - SSH enable/disable toggle
  - Username/password configuration
  - WiFi SSID and password
  - Locale settings (timezone, keyboard)

**SSH Access Methods:**
1. **Hostname (recommended for development):** `ssh pi@opengardenlab.local`
   - Relies on mDNS (Avahi/Bonjour) for local network hostname resolution
   - Works on most networks, may fail on networks with mDNS disabled
2. **Static IP (recommended for production):** `ssh pi@172.20.1.28`
   - Configured via `/etc/dhcpcd.conf`
   - Reliable, no dependency on mDNS
   - Requires router not using the static IP for DHCP assignments

### WiFi Configuration
**Local Network Connectivity** [Source: AC 3]
- WiFi configured during Raspberry Pi Imager advanced setup
- Alternatively, manual config via `wpa_supplicant.conf` in boot partition
- Network must support 2.4GHz (Pi Zero 2 W does not support 5GHz)

**Configuration file format** (if manual setup needed):
```
country=US
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid="YourNetworkName"
    psk="YourNetworkPassword"
}
```

### Python Version Requirements
**Python 3.9+** [Source: architecture/tech-stack.md]
- Required for firmware development
- Pre-installed on Raspberry Pi OS (typically 3.9 or 3.11 depending on OS release)
- Type hints, asyncio features needed for BLE server (bleak library)
- pip3 used for installing sensor libraries (Adafruit CircuitPython)

**Verification:** `python3 --version` must show 3.9.0 or higher

### Project Structure Preparation
This story prepares the Raspberry Pi hardware environment. Future stories will:
- Story 1.3: Enable I2C and 1-Wire interfaces for sensor communication
- Story 1.4: Install Python sensor libraries
- Story 1.6+: Clone `opengardenlab` repository to `/home/pi/opengardenlab/`

### Testing
**Testing Standards for Story 1.2:**
- **Test Type:** Manual hardware verification (no automated tests)
- **Verification Steps:**
  1. ‚úÖ Raspberry Pi OS boots successfully (power LED solid, activity LED blinks during boot)
  2. ‚úÖ SSH connection succeeds from development PC
  3. ‚úÖ WiFi connected (verify with `iwconfig wlan0` or `ip addr show wlan0`)
  4. ‚úÖ Hostname or static IP resolves reliably (test with `ping` and `ssh`)
  5. ‚úÖ Python 3.9+ available (`python3 --version`)
  6. ‚úÖ pip3 installed (`pip3 --version`)
  7. ‚úÖ Git installed (`git --version`)
  8. ‚úÖ System updated (`sudo apt update && sudo apt upgrade` completes successfully)
- **Success Criteria:** Developer can SSH into Pi without physical access, Python environment ready for firmware development
- **No automated tests required** - hardware configuration story
[Source: architecture/testing-strategy.md - adapted for infrastructure story]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-03 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*To be filled by QA agent*
